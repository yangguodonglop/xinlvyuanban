<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>首页</title>
		<link rel="stylesheet" type="text/css" href="/public/css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="/public/css/base.css" />
		<link rel="stylesheet" type="text/css" href="/public/css/index.css" />
		<link rel="stylesheet" type="text/css" href="/public/css/showLoging.css" />
		<style type="text/css">
			.back_mp{background: linear-gradient(#ffa538, #ff6d00); color: white; height: 465px; width: 274px; margin-top: 5%; border-radius: 5px;}
			.mar_b_30{margin-bottom: 30px;}
			.back_iocn{text-align: center; border-radius: 40px; overflow: hidden; top: 73px; left: 50%; margin-left: -43px; z-index: 1; padding: 5px;}
			.overs{display: none;}
		</style>
	</head>
	<body>
		<div id="app">
			<div class="row h_44 txt_cw ts_14 linear_tit_back mui-bar">
				<div class="mar_l_10" @click="addresslink()">{{places}} <img class="img1 mar_l_5" src="/public/imgs/img_01-min.png" alt="" /></div>
				<div class="tit_back"><img class="img2 mar_r_5" src="/public/imgs/img_02-min.png" alt="" /> 目的地/关键词</div>
				<img class="img3 mar_r_10" src="/public/imgs/logo(96x96).png" @click="clo_card()"/>
			</div>
			<!--轮播图-->
			<div class="mui-slider b_w zxb-slider rel pad_t_45">
				<img class="abs widths" style="z-index: 100; bottom: 6px;" src="/public/imgs/banner_zz.PNG" />
				<div class="mui-slider-group mui-slider-loop">
					<div v-for="item in banner" class="mui-slider-item" :onclick="item.url"><img :src="item.thumb" /></div>
				</div>
			</div>
			<!--导航模块-->
			<div class="row pad_r_10 pad_t_5 b_w">
				<!--<template v-for="item in navs">
					<img class="wid_25 pad_l_10" :src="item.thumb" />
				</template>-->

				<img class="wid_25 pad_l_10" src="/public/imgs/img1.png" @click="tothink('/ticket/index.html')"/>
				<img class="wid_25 pad_l_10" src="/public/imgs/img2.png" @click="tothink('/tours.html')"/>
				<img class="wid_25 pad_l_10" src="/public/imgs/img3.png" @click="tothink('/tours.html')"/>
				<img class="wid_25 pad_l_10" src="/public/imgs/img4.png" @click="tothink('/tours.html')"/>
			</div>
			<div class="row pad_r_10 b_w pad_t_10 pad_b_10">
				<!--<template v-for="item in navs1">
					<img class="wid_25 pad_l_10" :src="item.thumb" />
				</template>-->
				<img class="wid_25 pad_l_10" src="/public/imgs/img5.png" @click="tothink('/tours.html')"/>
				<img class="wid_25 pad_l_10" src="/public/imgs/img6.png" @click="tothink('/tours.html')"/>
				<img class="wid_25 pad_l_10" src="/public/imgs/img7.png" @click="tothink('/tours.html')"/>
				<img class="wid_25 pad_l_10" src="/public/imgs/img8.png" @click="tothink('/integral/index.html')"/>
			</div>

			<!--猜你想去-->
			<div class="b_w mar_t_10 ts_15" id="txt_tit">
				<div class="row pad_l_10 pad_r_10 pad_t_10 pad_b_10 tit_bor">
					<div class="txt_c1 row"><span class="iocn1 linear_back_c9"></span> 猜你想去</div>
					<div class="ts_12 pad_r_5">更多 ></div>
				</div>

				<!--文字-->
				<div :class="(mag_t < 0)?'index_tit_fix tit_bor':'index_tit_fix1 tit_bor'">
					<div class="row mar_l_20 mar_r_20">
						<span :class="(cur_page == 0)?'action_tit1':'action_tit'" @click="goto_item(0)">推荐</span>
						<span :class="(cur_page == 1)?'action_tit1':'action_tit'" @click="goto_item(1)">出境游</span>
						<span :class="(cur_page == 2)?'action_tit1':'action_tit'" @click="goto_item(2)">国内游</span>
						<span :class="(cur_page == 3)?'action_tit1':'action_tit'" @click="goto_item(3)">周边游</span>
					</div>
				</div>
				<div :class="(mag_t < 0)?'mar_t_37':''">
					<!--第一个内容区容器-->
					<img class="pad_t_10 pad_l_10 pad_r_10 widths" src="/public/imgs/img_100.jpg" id="gt_img1" />
					<div class="pad_l_10 pad_r_10  mar_b_5">
						<div class="row_wrap">
							<div v-for="item in dt1" v-cloak class="col wid_49 h_190 mar_b_10" @click="go_url(item)">
								<div class="rel">
									<span class="abs iocn2 pad_l_10 pad_r_15 txt_cw ts_12">{{item.start}}出发</span>
									<i><img class="widths zxb_img" :src="item.thumb" /></i>
								</div>
								<span class="mar_t_5 txt_c2 as_fs pad_l_5 pad_r_5 h_115">{{item.title}}</span>
								<div class="row widths mar_t_5">
									<div class="ts_12 txt_c1">￥<span class="ts_18">{{item.price}}</span> 起</div>
									<span class="txt_c3 pad_r_5 ts_11">{{item.id}}人购买</span>
								</div>
							</div>
						</div>
					</div>

					<!--第二个内容区容器-->
					<img class="pad_l_10 pad_r_10 widths" src="/public/imgs/img_100.jpg" id="gt_img2" />
					<div class="pad_l_10 pad_r_10 mar_b_5">
						<div class="row_wrap">
							<div v-for="item in dt2" v-cloak class="col wid_49 h_190 mar_b_10" @click="go_url(item)">
								<div class="rel">
									<span class="abs iocn2 pad_l_10 pad_r_15 txt_cw ts_12">{{item.start}}出发</span>
									<i><img class="widths zxb_img" :src="item.thumb" /></i>
								</div>
								<span class="mar_t_5 txt_c2 as_fs pad_l_5 pad_r_5 h_115">{{item.title}}</span>
								<div class="row widths mar_t_5">
									<div class="ts_12 txt_c1">￥<span class="ts_18">{{item.price}}</span> 起</div>
									<span class="txt_c3 pad_r_5 ts_11">{{item.id}}人购买</span>
								</div>
							</div>
						</div>
					</div>

					<!--第三个内容区容器-->
					<img class="pad_l_10 pad_r_10 widths" src="/public/imgs/img_100.jpg" id="gt_img3" />
					<div class="pad_l_10 pad_r_10 mar_b_5">
						<div class="row_wrap">
							<div v-for="item in dt3" v-cloak class="col wid_49 h_190 mar_b_10" @click="go_url(item)">
								<div class="rel">
									<span class="abs iocn2 pad_l_10 pad_r_15 txt_cw ts_12">{{item.start}}出发</span>
									<i><img class="widths zxb_img" :src="item.thumb" /></i>
								</div>
								<span class="mar_t_5 txt_c2 as_fs pad_l_5 pad_r_5 h_115">{{item.title}}</span>
								<div class="row widths mar_t_5">
									<div class="ts_12 txt_c1">￥<span class="ts_18">{{item.price}}</span> 起</div>
									<span class="txt_c3 pad_r_5 ts_11">{{item.id}}人购买</span>
								</div>
							</div>
						</div>
					</div>

					<!--第四个内容区容器-->
					<img class="pad_l_10 pad_r_10 widths" src="/public/imgs/img_100.jpg" id="gt_img4" />
					<div class="pad_l_10 pad_r_10 mar_b_5">
						<div class="row_wrap">
							<div v-for="item in dt4" v-cloak class="col wid_49 h_190 mar_b_10" @click="go_url(item)">
								<div class="rel">
									<span class="abs iocn2 pad_l_10 pad_r_15 txt_cw ts_12">{{item.start}}出发</span>
									<i><img class="widths zxb_img" :src="item.thumb" /></i>
								</div>
								<span class="mar_t_5 txt_c2 as_fs pad_l_5 pad_r_5 h_115">{{item.title}}</span>
								<div class="row widths mar_t_5">
									<div class="ts_12 txt_c1">￥<span class="ts_18">{{item.price}}</span> 起</div>
									<span class="txt_c3 pad_r_5 ts_11">{{item.id}}人购买</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="mar_b_50"></div>
		<div class="mui-bar mui-bar-tab z_9999" id="nav">
			<template v-for="n in 5">
				<a class="mui-tab-item" v-on:click="tonavlink(navUrl[n-1])">
					<span class="mui-icon"> <img class="h_22" :src="navImg[n-1]"/></span>
					<span id="txt_1" class="mui-tab-label" v-bind:class="navnum ==(n-1)?'txt_c1':'txt_c2'">{{navName[n-1]}}</span>
				</a>
			</template>
		</div>
	</body>
</html>
<script src="/public/js/mui.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/public/js/vue.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/public/js/vue_resource.js" type="text/javascript" charset="utf-8"></script>
<script src="/public/config/config.js" type="text/javascript" charset="utf-8"></script>
<script src="/public/js/showLoding.js" type="text/javascript" charset="utf-8"></script>
<script src="/public/js/nav.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" charset="utf-8">
	mui.init();
	var app = new Vue({
		el: '#app',
		data: {
			places: "武汉",
			navs: '',
			navs1: '',
			banner: '',
			dt1: '',
			dt2: '',
			dt3: '',
			dt4: '',
			cur_page: 0,
			mag_t: 10,
			citys: '武汉',
			card: true,
		},
		mounted: function() {
			(function($, doc) {

			}(mui, document));

			//获取城市传过来的ID
			var js_citys_id = window.sessionStorage ? sessionStorage.getItem("get_city_ids") : Cookie.read("get_city_ids");
			if(js_citys_id == null) {

				this.places = "武汉"
			} else {

				this.places = js_citys_id
			}
			var  data = {
				city: js_citys_id
			}
			//首页位置切换
			Vue.http.options.emulateJSON = true;
			Vue.http.post(URLS + '/city', data).then(function(respones) {

			}, function(err) {
				mui.toast('网络不可用，请检查网络');
			});

			//轮播下导航
			Vue.http.get(URLS + '/menu').then(function(respones) {

				//将8张图片分为两个数组保存起来
				var new_nav = []
				var new_nav1 = []
				for(var i = 0; i <= 3; i++) {
					new_nav.push(respones.body.data[i])
				}

				for(var i = 4; i <= 7; i++) {
					new_nav1.push(respones.body.data[i])
				}
				app.navs = new_nav;
				app.navs1 = new_nav1;
			}, function(err) {
				mui.toast('网络不可用，请检查网络');
			});

			//获取轮播图
			Vue.http.get(URLS + '/banner').then(function(response) {
				//加头加尾
				response.body.data.unshift(response.body.data[response.body.data.length - 1]);
				response.body.data.push(response.body.data[1]);
				app.banner = response.body.data;
				init_gall();
				mui.hideLoading();
			}, function(err) {
				mui.toast('网络异常！');
			});

			//获取页面数据
			
				mui.showLoading("正在刷新数据...","div");
            var info = {
                city: this.places
			}
            Vue.http.get(URLS + '/recommend',info).then(function(response) {
					console.log(response);
				app.dt1 = response.body.data.abroad;
				app.dt2 = response.body.data.inland;
				app.dt3 = response.body.data.recommend;
				app.dt4 = response.body.data.tour_around;
				mui.hideLoading();
				//延时动态修改页面图片的高度
				setTimeout(function() {
					var aImg = document.getElementsByClassName('zxb_img');
					var w = document.body.clientWidth;
					for(var i = 0; i < aImg.length; i++) {
						aImg[i].style.height = w / 3.1 + 'px';
					}
					set_div();
				}, 200);

			}, function(err) {
				mui.toast('网络异常！');
			});
			//延时初始化轮播组件
			var init_gall = function() {
				setTimeout(function() {
					var gallery = mui('.zxb-slider');
					gallery.slider({
						interval: 5000 //自动轮播周期，若为0则不自动播放，默认为0；
					});
				}, 200);
			}

			//悬停功能
			window.onscroll = function() {
				//获取div距离顶部的距离
				var mTop = document.getElementById('txt_tit').offsetTop;
				//减去滚动条的高度
				var sTop;
				if(document.documentElement && document.documentElement.scrollTop)
					sTop = document.documentElement.scrollTop;
				else if(document.body)
					sTop = document.body.scrollTop;
				var result = mTop - sTop;
				app.mag_t = result;

				//得到每个部位距离顶部的距离
				var img1 = document.getElementById('gt_img1').offsetTop;
				var img2 = document.getElementById('gt_img2').offsetTop;
				var img3 = document.getElementById('gt_img3').offsetTop;
				var img4 = document.getElementById('gt_img4').offsetTop;
				var n1 = img1 - sTop;
				var n2 = img2 - sTop;
				var n3 = img3 - sTop;
				var n4 = img4 - sTop;
				if(n1 < 92 && n2 > 92)
					app.cur_page = 0;
				else if(n2 < 92 && n3 > 92)
					app.cur_page = 1;
				else if(n3 < 92 && n4 > 92)
					app.cur_page = 2;
				else if(n4 < 92)
					app.cur_page = 3;
			}

//			function goto_item(n) {
//
//			}
			//			mui.showLoading('正在加载数据...');
			//			this.getdata();
		},
		methods: {
			addresslink: function() {
				window.location.href = "citys.html"
			},
			goto_item: function(n) {
				//console.log(document.getElementById('gt_img' + (n + 1)).offsetTop);
				window.scrollTo(0, document.getElementById('gt_img' + (n + 1)).offsetTop - 75);
			},
			//点击跳转页面传递ID参数
			go_url: function(item) {
				var product_id = item.id

				if(window.sessionStorage) {
					sessionStorage.setItem("id_item", product_id);
				} else {
					Cookie.write("id_item", product_id);
				}
				window.location.href = "/details/index.html";
			},
			tothink:function(link){
				window.location.href = link;
			},
			//开关卡片
			clo_card:function(){
				if(this.card)
					document.documentElement.style.overflow='auto';
				else{
					//弹出之前回到顶部
					window.scrollTo(0, 0);
					document.documentElement.style.overflow='hidden';
				}
				this.card = !this.card;
			}
		}
	});
	//动态设置高度
	function set_div(){
		var list = document.getElementsByClassName('h_190');
		for (var i=0; i < list.length; i++) {
			list[i].style.height = window.screen.width*0.53 +'px'; 
		}
	}
</script>